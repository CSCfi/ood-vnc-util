<% sing_image = File.join("/appl", "opt", "ood_util", "soft", "vnc_images", "#{desktop}.sif") -%>
---
batch_connect:
  template: vnc
  header: |
    source /appl/profile/zz-csc-env.sh
    [[ $(type -t module) == "function" ]] & export -f module
    unset XDG_RUNTIME_DIR
  #  export PATH="$PATH:/appl/opt/ood_util/soft/turbovnc/opt/TurboVNC/bin"
  #websockify_cmd: 'singularity exec "/appl/opt/ood_util/soft/vnc_images/novnc.sif" /opt/novnc/utils/websockify/run'
  script_wrapper: |
    module purge
    cat << "CTRSCRIPT" > container.sh
    %s
    CTRSCRIPT
    export SING_IMAGE="<%= sing_image -%>"
    export SING_FLAGS="--nv -B /tmp:/tmp -B /run:/run -B /appl:/appl"
    singularity_wrapper exec /bin/bash container.sh
script:
  native:
    - '-c'
    - '<%= cores %>'
    - '-t'
    - '<%= time %>'
    - '--mem=<%= memory %>G'
    - '--gres=nvme:<%= nvme %>'
