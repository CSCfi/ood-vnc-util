Bootstrap: docker
From: rockylinux:8.6 

%environment 
  SHELL=/bin/bash
  export SHELL
  export "PATH=/opt/TurboVNC/bin:${PATH}"
  # https://stackoverflow.com/questions/2499794/how-to-fix-a-locale-setting-warning-from-perl
  export LC_CTYPE=en_US.UTF-8
  export LC_ALL=en_US.UTF-8

%post 

    dnf -y install dnf-plugins-core
    yum -y install epel-release
    dnf -y install firefox  
    dnf -y install gedit
    dnf -y install glibc-all-langpacks    
    dnf -y config-manager --set-enabled powertools
    dnf -y update
    dnf -y install glibc-all-langpacks
    yum -y install Lmod
    yum -y install xorg-x11-fonts-Type1 xorg-x11-fonts-misc
    yum -y install libglvnd-opengl
    yum install -y freeglut-devel
    dnf -y groupinstall "xfce"

    yum -y install xterm
    yum -y install xkeyboard-config
    yum -y install hostname
    yum -y install which
    yum -y install python3
    yum -y install python3-pip
    yes | pip3 install numpy
    yum -y install xkbcomp
    yum -y install xorg-x11-xkb-utils
    yum -y install xauth
    yum -y install wget
    yum -y install tar
    yum -y install xz
    yum install -y \
    less \
    vim \
    libxkbcommon-x11 \
    libglvnd \
    libXv \
    xorg-x11-server-Xvfb \
    tcsh \
    motif \
    libXp \
    libXpm \
    xterm \
    git \
    xdg-user-dirs

    wget http://www.TurboVNC.org/key/VGL-GPG-KEY
    rpm --import VGL-GPG-KEY
    yum -y install git
    export TURBOVNC_VERSION=2.2.6
    wget --no-check-certificate https://sourceforge.net/projects/turbovnc/files/${TURBOVNC_VERSION}/turbovnc-${TURBOVNC_VERSION}.x86_64.rpm
    yum -y install turbovnc-${TURBOVNC_VERSION}.x86_64.rpm 
    rm turbovnc-${TURBOVNC_VERSION}.x86_64.rpm 
    mkdir -p /opt/websockify
    wget https://github.com/novnc/websockify/archive/master.tar.gz -q -O - | tar xzf - -C /opt/websockify --strip-components=1
    yum clean all && rm -rf /var/cache/yum
    dbus-uuidgen > /etc/machine-id
